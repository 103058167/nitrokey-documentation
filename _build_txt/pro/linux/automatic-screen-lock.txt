Blocco automatico dello schermo alla rimozione

(Nitrokey Pro 2 - Linux)

Requisiti

Configurazione  Creare il file .rules  Creare lo script gnome-
screensaver-lock  Eseguire lo script

Uso

Questa guida ti guiderà attraverso la configurazione del tuo computer,
per bloccare automaticamente la tua sessione quando rimuovi la
Nitrokey.

La configurazione richiede la creazione di due file in due diverse
directory.

Requisiti

Ubuntu 20.04 o Debian 10 (Buster), entrambi con ` Gnome Display
Manager <https://wiki.gnome.org/Projects/GDM>`_ installato.

Nitrokey Pro 2, Nitrokey Storage 2 o Nitrokey HSM 2

Configurazione

Creare il file .rules

Con il vostro editor di testo preferito create un file chiamato
"85-nitrokey.rules"

   $ sudo editor /etc/udev/rules.d/85-nitrokey.rules

Aggiungere la seguente linea al file

   ACTION=="remove", ENV{PRODUCT}=="20a0/4108/101" RUN+="/usr/local/bin/gnome-screensaver-lock"

Salvate il file e uscite dall'editor.

Questo file imposta una nuova regola hardware che esegue il "gnome-
screensaver-lock" alla rimozione del dispositivo Nitrokey.

Dovreste cambiare la configurazione secondo il dispositivo che state
usando come segue:

Nitrokey Pro: ENV{PRODUCT}=="20a0/4108/101"

Nitrokey HSM: ENV{PRODUCT}=="20a0/4230/101"

Nitrokey Storage: ENV{PRODUCT}=="20a0/4109/101"

Creare lo script gnome-screensaver-lock

Con il vostro editor di testo preferito create un file chiamato
"gnome-screensaver-lock"

   $ sudo editor /usr/local/bin/gnome-screensaver-lock

Aggiungere il seguente testo

   user=`ps axo user:30,comm | egrep "gdm-(wayland|x)" | awk '{print $1}'`

   if [ -n $user ]; then
           su $user -c "/usr/bin/dbus-send --type=method_call --dest=org.gnome.ScreenSaver /org/gnome/ScreenSaver org.gnome.ScreenSaver.Lock"
   fi

Nel primo passo, questo script cerca il nome utente della sessione
gnome, cioè "user".

Quando viene chiamato alla rimozione della Nitrokey, lo script
interroga "user", passa alla sua sessione, e blocca lo schermo
richiedendo la schermata del salvaschermo.

Eseguire lo script

Una volta impostato tutto, eseguite lo script una volta, e bloccherà
lo schermo. Non importa se la Nitrokey è collegata o meno per questa
prima esecuzione.

Uso

A questo punto puoi accedere nuovamente alla tua sessione inserendo la
tua password, e (ri)inserire la tua Nitrokey se non l'hai fatto prima.

La prossima volta che staccherete la vostra Nitrokey dal computer,
essa bloccherà automaticamente lo schermo.
